# Полное описание функционала системы "Расход Организации"

## Оглавление

1. [Управление организационной структурой](#1-управление-организационной-структурой)
2. [Управление сотрудниками](#2-управление-сотрудниками)
3. [Управление статусами сотрудников](#3-управление-статусами-сотрудников)
4. [Система прикомандирования/откомандирования](#4-система-прикомандированияоткомандирования)
5. [Штатное расписание и вакансии](#5-штатное-расписание-и-вакансии)
6. [Генерация отчетов](#6-генерация-отчетов)
7. [Система прав доступа (RBAC)](#7-система-прав-доступа-rbac)
8. [Журнал аудита и история изменений](#8-журнал-аудита-и-история-изменений)
9. [Система уведомлений](#9-система-уведомлений)
10. [Справочники](#10-справочники)
11. [Портал сотрудников](#11-портал-сотрудников)

---

## 1. Управление организационной структурой

### 1.1 Назначение модуля

Модуль предназначен для создания и управления иерархической структурой организации с поддержкой трех вариантов организационного дерева различной глубины.

### 1.2 Типы организационных структур

Система поддерживает три варианта иерархии:

**Вариант 1: Трехуровневая структура**
```
Организация
└── Департамент
    └── Управление
        └── Отдел
```

**Вариант 2: Двухуровневая структура**
```
Организация
└── Департамент
    └── Управление
```

**Вариант 3: Одноуровневая структура**
```
Организация
└── Департамент
```

### 1.3 Функциональные возможности

**Создание подразделений:**
- Создание департаментов на верхнем уровне
- Создание управлений внутри департаментов
- Создание отделов внутри управлений
- Автоматическая валидация корректности иерархии

**Редактирование подразделений:**
- Изменение наименования подразделения
- Изменение кода подразделения (уникальный идентификатор)
- Изменение порядка отображения
- Установка признака "активное/неактивное"

**Перемещение подразделений:**
- Перемещение управления из одного департамента в другой
- Перемещение отдела из одного управления в другое
- Контроль ограничений при перемещении:
  - Нельзя переместить подразделение "само в себя"
  - Проверка корректности новой иерархии
  - Проверка отсутствия циклических зависимостей

**Удаление подразделений:**
- Мягкое удаление (архивация)
- Проверки перед удалением:
  - Подразделение не должно содержать активных сотрудников
  - Все дочерние подразделения должны быть удалены или перемещены
- Возможность восстановления из архива

**Просмотр структуры:**
- Древовидное отображение всей структуры
- Отображение в виде списка с отступами
- Поиск подразделения по наименованию или коду
- Фильтрация по типу (департамент/управление/отдел)
- Отображение количества сотрудников в каждом подразделении

### 1.4 Бизнес-правила

1. Код подразделения должен быть уникальным в рамках организации
2. Наименование подразделения должно быть уникальным в рамках родительского подразделения
3. Нельзя создать более 5 уровней вложенности
4. При архивации подразделения все сотрудники должны быть переведены
5. Активное подразделение должно иметь активного родителя

---

## 2. Управление сотрудниками

### 2.1 Назначение модуля

Модуль обеспечивает полный жизненный цикл сотрудника в организации: от приема на работу до увольнения.

### 2.2 Карточка сотрудника

**Основная информация:**
- Табельный номер (уникальный, генерируется автоматически)
- Фамилия, Имя, Отчество
- Дата рождения
- Пол
- Фотография 3×4 (опционально)

**Служебная информация:**
- Текущее подразделение
- Должность
- Дата приема на работу
- Дата увольнения (если уволен)
- Статус трудоустройства (работает/уволен)

**Контактные данные:**
- Рабочий телефон
- Рабочий email
- Личный телефон (опционально)
- Личный email (опционально)

**Дополнительная информация:**
- Воинское звание (если применимо)
- Образование
- Специальность
- Примечания

### 2.3 Функциональные возможности

**Прием на работу (Onboarding):**
- Создание новой карточки сотрудника
- Автоматическое присвоение табельного номера
- Назначение на должность в подразделении
- Выбор типа назначения:
  - На штатную единицу (занимает место в штатном расписании)
  - "За счёт" / И.О. (не занимает штатную единицу)
- Установка начального статуса "В строю"
- Загрузка фотографии
- Отправка уведомления о приеме

**Редактирование данных сотрудника:**
- Изменение личных данных (ФИО, дата рождения, пол)
- Обновление контактной информации
- Замена фотографии
- Изменение воинского звания
- Редактирование примечаний

**Перевод сотрудника:**
- Перевод в другое подразделение с изменением должности
- Перевод внутри подразделения с изменением должности
- Повышение/понижение в должности без смены подразделения
- Указание даты перевода (может быть в будущем для планирования)
- Указание причины перевода
- Выбор типа перевода:
  - Постоянный перевод
  - Временный перевод (с указанием срока)
- Автоматическое создание записи в истории переводов

**Увольнение (Offboarding):**
- Указание даты увольнения
- Выбор причины увольнения (из справочника)
- Указание номера приказа об увольнении
- Автоматическая проверка:
  - Отсутствие активных прикомандирований
  - Закрытие всех запланированных статусов
- Освобождение штатной единицы
- Архивация карточки сотрудника
- Отправка уведомления об увольнении

**Поиск и фильтрация:**
- Полнотекстовый поиск по ФИО
- Поиск по табельному номеру
- Фильтрация по подразделению
- Фильтрация по должности
- Фильтрация по статусу (работает/уволен)
- Фильтрация по текущему статусу (в строю/отпуск/больничный и т.д.)
- Фильтрация по воинскому званию

**Массовые операции:**
- Массовое изменение статусов
- Массовый перевод сотрудников
- Экспорт списка сотрудников в Excel

### 2.4 Бизнес-правила

1. Табельный номер генерируется автоматически и не может быть изменен
2. Дата приема не может быть в будущем
3. Дата увольнения не может быть раньше даты приема
4. Сотрудник не может быть назначен на несуществующую должность
5. При переводе проверяется доступность штатной единицы
6. Нельзя уволить сотрудника с активным прикомандированием
7. ФИО + дата рождения должны быть уникальны (защита от дублей)

---

## 3. Управление статусами сотрудников

### 3.1 Назначение модуля

Модуль обеспечивает учет текущего состояния сотрудников и планирование изменений статусов.

### 3.2 Типы статусов

**Основные статусы:**

1. **В строю**
   - Сотрудник находится на рабочем месте
   - Выполняет свои должностные обязанности
   - Статус по умолчанию

2. **Отпуск**
   - Ежегодный оплачиваемый отпуск
   - Указывается дата начала и окончания
   - Учитывается в расчете численности

3. **Больничный**
   - Временная нетрудоспособность
   - Указывается дата начала, окончание может быть не определено
   - Может быть продлен

4. **Командировка**
   - Служебная поездка
   - Указывается место командировки
   - Указываются даты начала и окончания

5. **Учеба**
   - Повышение квалификации
   - Курсы, семинары, конференции
   - Указываются даты и место проведения

6. **Отсутствие по иным причинам**
   - Административный отпуск
   - Отпуск без сохранения заработной платы
   - Прочие причины отсутствия

7. **Прикомандирован из**
   - Сотрудник временно работает в подразделении
   - Не входит в штатную численность подразделения
   - Указывается подразделение-источник

8. **Откомандирован в**
   - Сотрудник временно работает в другом подразделении
   - Остается в штатной численности своего подразделения
   - Указывается подразделение-приемник

### 3.3 Функциональные возможности

**Установка текущего статуса:**
- Выбор типа статуса
- Указание даты начала
- Указание даты окончания (обязательно для всех статусов кроме "В строю")
- Добавление комментария (опционально)
- Прикрепление документов (приказы, справки)
- Автоматическая валидация:
  - Дата начала не раньше даты приема
  - Дата окончания не раньше даты начала
  - Нет пересечений с другими активными статусами

**Планирование статусов:**
- Создание статуса с датой начала в будущем
- Массовое планирование (например, график отпусков)
- Автоматическое применение при наступлении даты
- Возможность отмены или изменения до применения
- Уведомления за N дней до начала

**Продление статуса:**
- Изменение даты окончания текущего статуса
- Автоматическое добавление записи в историю
- Уведомление руководителя о продлении

**Досрочное завершение статуса:**
- Установка новой даты окончания (раньше плановой)
- Указание причины досрочного завершения
- Автоматический возврат в статус "В строю"

**Просмотр истории статусов:**
- Хронологический список всех статусов сотрудника
- Фильтрация по типу статуса
- Фильтрация по периоду
- Экспорт истории в Excel

**Отчеты по статусам:**
- Текущий расход подразделения на дату
- Плановый расход на будущую дату
- Статистика по типам отсутствий за период
- Сравнение расхода разных подразделений

### 3.4 Особенности работы со статусами

**Правила смены статусов:**
- При установке нового статуса текущий автоматически завершается
- Нельзя установить два активных статуса одновременно
- Статус "В строю" не требует указания даты окончания
- Все остальные статусы должны иметь плановую дату окончания

**Автоматические действия:**
- При окончании статуса автоматический возврат в "В строю"
- Уведомление за 3 дня до окончания длительного статуса (отпуск, командировка)
- Ежедневная проверка и применение запланированных статусов
- Автоматическое закрытие статуса при увольнении сотрудника

**Ограничения доступа:**
- Руководитель может изменять статусы только в своем подразделении
- Системный администратор может изменять любые статусы
- Кадровый администратор может изменять статусы в зоне ответственности
- Наблюдатели могут только просматривать статусы

### 3.5 Бизнес-правила

1. Один сотрудник не может иметь два активных статуса одновременно
2. Дата начала статуса не может быть раньше даты приема на работу
3. Дата окончания не может быть раньше даты начала
4. Запланированные статусы можно изменять и отменять до даты начала
5. После применения статус можно только завершить досрочно или продлить
6. При увольнении все будущие статусы автоматически отменяются
7. Длительность непрерывного отпуска не может превышать 45 дней (настраивается)

---

## 4. Система прикомандирования/откомандирования

### 4.1 Назначение модуля

Модуль реализует процесс временного перемещения сотрудников между подразделениями с сохранением штатной численности.

### 4.2 Концепция прикомандирования/откомандирования

**Откомандирование:**
- Сотрудник временно переводится в другое подразделение
- Остается в штате своего подразделения
- Учитывается в расходе принимающего подразделения
- Требует согласования со стороны принимающего руководителя

**Прикомандирование:**
- Подразделение принимает сотрудника из другого подразделения
- Сотрудник не входит в штатную численность
- Учитывается в расходе как "прикомандированный"
- Требует согласования руководителя подразделения-источника

### 4.3 Процесс откомандирования

**Инициация откомандирования (Роль-3, Роль-4):**
1. Руководитель выбирает сотрудника своего подразделения
2. Указывает подразделение-приемник
3. Устанавливает период откомандирования (дата начала и окончания)
4. Указывает причину откомандирования
5. Добавляет комментарий (опционально)
6. Отправляет запрос на согласование

**Согласование принимающей стороной:**
1. Руководитель подразделения-приемника получает уведомление
2. Просматривает данные сотрудника и причину откомандирования
3. Принимает решение:
   - **Одобрить** - откомандирование активируется
   - **Отклонить** - запрос отклоняется с указанием причины
4. Автоматическое уведомление инициатору о решении

**Применение откомандирования:**
- При одобрении создается статус "Откомандирован в [подразделение]"
- Сотрудник отображается в расходе обоих подразделений:
  - В своем: как "откомандирован"
  - В принимающем: как "прикомандирован из [подразделение]"
- Численность подразделений пересчитывается

**Завершение откомандирования:**
- Автоматическое завершение по истечении срока
- Досрочное завершение по инициативе любой из сторон
- Продление срока (требует повторного согласования)
- Возврат сотрудника в статус "В строю" в своем подразделении

### 4.4 Процесс прикомандирования

**Инициация прикомандирования (Роль-3, Роль-4):**
1. Руководитель подает заявку на прикомандирование
2. Указывает подразделение-источник
3. Выбирает сотрудника из списка доступных (не занятых откомандированием)
4. Устанавливает период прикомандирования
5. Указывает причину
6. Отправляет запрос руководителю подразделения-источника

**Согласование отправляющей стороной:**
1. Руководитель подразделения-источника получает запрос
2. Проверяет возможность откомандирования
3. Принимает решение (одобрить/отклонить)

**Применение прикомандирования:**
- Создается связка откомандирование-прикомандирование
- Изменяются статусы сотрудника в обоих подразделениях
- Обновляется расход

### 4.5 Функциональные возможности

**Создание запроса:**
- Выбор типа (откомандирование/прикомандирование)
- Выбор сотрудника
- Выбор подразделения (приемника или источника)
- Установка периода
- Указание причины из справочника + свободный комментарий
- Прикрепление документов (приказы)

**Управление запросами:**
- Просмотр списка активных запросов
- Фильтрация по статусу (на согласовании/одобрено/отклонено)
- Фильтрация по подразделениям
- Поиск по ФИО сотрудника
- Сортировка по дате создания

**Согласование:**
- Просмотр деталей запроса
- Просмотр карточки сотрудника
- Одобрение с комментарием
- Отклонение с указанием причины
- Отправка уведомлений обеим сторонам

**Мониторинг:**
- Список всех активных откомандирований/прикомандирований
- Уведомления о скором окончании срока (за 7 дней)
- История всех операций
- Статистика по подразделениям

**Досрочное завершение:**
- Инициатор или получатель может завершить досрочно
- Указание причины досрочного завершения
- Автоматическое обновление статусов

**Продление:**
- Запрос на продление срока
- Повторное согласование
- Изменение даты окончания

### 4.6 Отчеты

**Отчет по текущим командированиям:**
- Список всех активных откомандирований
- Группировка по подразделениям
- Период действия
- Экспорт в Excel/PDF

**Статистика командирований:**
- Количество командирований за период
- Средняя длительность
- Самые активные подразделения (отправители/приемники)
- Причины командирований

### 4.7 Бизнес-правила

1. Сотрудник не может быть откомандирован дважды одновременно
2. Период откомандирования не может превышать 6 месяцев (настраивается)
3. Нельзя откомандировать сотрудника, находящегося в длительном статусе (отпуск, больничный)
4. При увольнении сотрудника все активные командирования завершаются
5. Руководитель не может откомандировать сам себя
6. Запрос на согласование действителен 14 дней, после чего автоматически отклоняется
7. Продление возможно не более 2 раз подряд
8. Минимальный срок откомандирования - 1 день
9. За 7 дней до окончания срока отправляется уведомление обеим сторонам

---

## 5. Штатное расписание и вакансии

### 5.1 Назначение модуля

Модуль обеспечивает управление штатным расписанием, контроль занятости штатных единиц и публикацию вакансий.

### 5.2 Штатное расписание

**Структура штатного расписания:**

Штатное расписание представляет собой утвержденный перечень должностей с указанием:
- Подразделение
- Должность (из справочника должностей)
- Количество штатных единиц
- Количество занятых единиц
- Количество вакантных единиц
- Оклад или диапазон окладов (опционально)
- Дата ввода в действие
- Дата окончания действия (если есть)

**Иерархия должностей:**

Должности имеют ранги (приоритет), определяющий их иерархию:
- Высший ранг - руководящие должности
- Средний ранг - специалисты
- Низший ранг - вспомогательный персонал

Ранг используется для:
- Сортировки при отображении
- Контроля при назначении сотрудников
- Генерации отчетов

### 5.3 Функциональные возможности

**Создание штатного расписания:**
- Создание для подразделения (департамента, управления, отдела)
- Добавление должностей с указанием количества единиц
- Указание квалификационных требований
- Установка даты начала действия
- Утверждение расписания

**Редактирование штатного расписания:**
- Добавление новых должностей
- Изменение количества штатных единиц:
  - Увеличение (добавление вакансий)
  - Уменьшение (при условии отсутствия занятых единиц сверх нового количества)
- Изменение окладов
- Изменение требований к должности
- Установка даты окончания действия (для выводимых должностей)

**Контроль занятости:**
- Автоматический подсчет занятых единиц
- Автоматический подсчет вакантных единиц
- Формула: Вакантные = Штатные - Занятые
- Предупреждение при превышении штатной численности
- Отображение списка сотрудников на каждой должности

**Просмотр штатного расписания:**
- Просмотр по подразделениям
- Группировка по должностям
- Фильтрация по уровню подразделения (департамент/управление/отдел)
- Отображение статуса (есть вакансии/полностью укомплектовано/перебор)
- Экспорт в Excel

### 5.4 Управление вакансиями

**Создание вакансии:**
- Выбор подразделения
- Выбор должности из штатного расписания (доступны только должности с вакантными единицами)
- Указание требований:
  - Образование
  - Опыт работы
  - Специальные навыки
  - Знание языков
- Описание обязанностей
- Условия работы (график, оклад)
- Дата публикации
- Дата закрытия вакансии
- Статус вакансии:
  - Черновик (не опубликована)
  - Активна (опубликована, идет подбор)
  - Закрыта (вакансия закрыта, должность занята)
  - Архив (вакансия отменена)

**Редактирование вакансии:**
- Изменение описания и требований
- Изменение статуса
- Продление срока публикации
- Снятие с публикации

**Закрытие вакансии:**
- Ручное закрытие администратором
- Автоматическое закрытие при приеме сотрудника на должность
- Указание причины закрытия
- Перенос в архив

**Публикация вакансий:**
- Внутренний портал вакансий
- Доступ всем пользователям системы
- Фильтрация по подразделениям
- Поиск по ключевым словам
- Сортировка по дате публикации

### 5.5 Прием сотрудника на вакансию

**Процесс приема:**
1. Кадровый администратор выбирает активную вакансию
2. Создает карточку нового сотрудника
3. Указывает дату приема на работу
4. Система автоматически:
   - Назначает сотрудника на должность из вакансии
   - Уменьшает количество вакантных единиц
   - Увеличивает количество занятых единиц
   - Закрывает вакансию (если это была последняя вакантная единица)
   - Отправляет уведомление руководителю подразделения

### 5.6 Назначение "за счёт" (И.О.)

**Концепция:**
Возможность назначить сотрудника на должность без занятия штатной единицы.

**Применение:**
- Временное исполнение обязанностей (И.О.)
- Совмещение должностей
- Дополнительная нагрузка

**Особенности:**
- Не занимает штатную единицу
- Не влияет на количество вакантных единиц
- Отображается отдельно в отчетах
- Имеет срок действия (обязательно)
- Требует указания причины
- Может быть завершено досрочно

**Создание назначения "за счёт":**
- Выбор сотрудника (уже работающего в организации)
- Выбор должности (любая из штатного расписания)
- Установка периода
- Указание причины
- Сохранение основной должности сотрудника

### 5.7 Отчеты по штатному расписанию

**Отчет по штатной численности:**
- Подразделение
- Должность
- Штатных единиц
- Занято
- Вакантно
- Процент укомплектованности
- Группировка по подразделениям
- Итоговые суммы

**Отчет по вакансиям:**
- Список всех активных вакансий
- Дата публикации
- Количество дней в публикации
- Подразделение и должность
- Статус подбора

**Аналитика по приему:**
- Количество приемов за период
- Среднее время закрытия вакансии
- Топ подразделений по приему
- Соотношение прием/увольнение

### 5.8 Бизнес-правила

1. Количество занятых единиц не может превышать штатное количество (кроме назначений "за счёт")
2. Нельзя уменьшить штатное количество ниже занятого
3. Нельзя удалить должность, если на ней есть сотрудники
4. Вакансия может быть создана только для должности с вакантными единицами
5. При приеме сотрудника на вакансию она автоматически закрывается
6. Назначение "за счёт" обязательно имеет срок действия
7. Один сотрудник может иметь несколько назначений "за счёт" одновременно
8. Штатное расписание имеет дату начала действия и может иметь дату окончания

---

## 6. Генерация отчетов

### 6.1 Назначение модуля

Модуль обеспечивает автоматическую генерацию различных отчетов по кадровому составу и статусам сотрудников в трех форматах: DOCX, XLSX, PDF.

### 6.2 Типы отчетов

**1. Отчет по расходу на дату**

Показывает состояние сотрудников на конкретную дату.

**Параметры:**
- Дата формирования отчета
- Подразделение (возможен выбор всей организации)
- Уровень детализации (департамент/управление/отдел)

**Содержание:**
- Подразделение
- Штатная численность
- В строю
- В отпуске
- На больничном
- В командировке
- На учебе
- Прикомандировано из других подразделений
- Откомандировано в другие подразделения
- Отсутствуют по иным причинам
- Итого наличествует (В строю + Прикомандированные)
- Процент наличия

**Группировка:**
- По департаментам
- По управлениям внутри департамента
- По отделам внутри управления
- Итоговые строки на каждом уровне

**Форматы вывода:**
- XLSX - таблица с формулами и условным форматированием
- DOCX - форматированная таблица с заголовками
- PDF - готовый к печати документ

**2. Динамический отчет по периоду**

Показывает изменение численности и статусов за период.

**Параметры:**
- Дата начала периода
- Дата окончания периода
- Подразделение
- Группировка (по дням/неделям/месяцам)

**Содержание:**
- Временной срез (день/неделя/месяц)
- Численность на начало периода
- Прием
- Увольнение
- Переводы внутрь подразделения
- Переводы из подразделения
- Численность на конец периода
- Средняя численность в строю
- Средний процент отсутствий

**Графики (только в PDF и XLSX):**
- График изменения численности
- Диаграмма распределения по статусам

**3. Отчет по прикомандированиям/откомандированиям**

Показывает все движения сотрудников между подразделениями.

**Параметры:**
- Период
- Подразделение (источник или приемник)
- Тип (прикомандирования/откомандирования/все)
- Статус (активные/завершенные/все)

**Содержание:**
- ФИО сотрудника
- Должность
- Подразделение-источник
- Подразделение-приемник
- Дата начала
- Дата окончания
- Фактическая дата окончания
- Длительность (дней)
- Причина
- Статус (активно/завершено/отменено)

**Итоги:**
- Общее количество командирований
- Средняя длительность
- Топ подразделений-отправителей
- Топ подразделений-получателей

**4. Отчет по вакансиям**

Показывает текущее состояние вакансий и укомплектованности.

**Параметры:**
- Подразделение
- Статус вакансий (активные/закрытые/все)
- Период (для закрытых вакансий)

**Содержание:**
- Подразделение
- Должность
- Штатное количество
- Занято
- Вакантно
- Статус вакансии
- Дата публикации
- Дней в публикации
- Дата закрытия

**Аналитика:**
- Общая укомплектованность (%)
- Количество активных вакансий
- Средний срок закрытия вакансии
- Проблемные вакансии (открыты > 90 дней)

**5. Отчет по штатному расписанию**

Полное штатное расписание с детализацией.

**Параметры:**
- Подразделение
- Дата актуальности
- Включать неактивные должности (да/нет)

**Содержание:**
- Подразделение (иерархия)
- Должность (с учетом ранга)
- Штатное количество
- Список сотрудников на должности:
  - Табельный номер
  - ФИО
  - Дата назначения
  - Тип назначения (штатное/за счёт)
- Вакантные единицы
- Примечания

**Сортировка:**
- По подразделениям (иерархически)
- Внутри подразделения по рангу должности
- Внутри должности по ФИО

**6. Индивидуальная карточка сотрудника**

Полная информация о сотруднике.

**Содержание:**
- Личные данные с фотографией
- Текущая должность и подразделение
- История назначений и переводов
- История статусов за последний год
- Активные прикомандирования/откомандирования
- Запланированные статусы
- Примечания и документы

**7. Статистический отчет**

Сводная статистика по организации.

**Параметры:**
- Период
- Подразделение

**Содержание:**
- Общая численность (начало/конец периода)
- Прием за период
- Увольнение за период
- Текучесть кадров (%)
- Средний процент присутствия
- Топ причин отсутствий
- Распределение по должностям
- Распределение по воинским званиям
- Возрастная структура
- Структура по стажу работы

**8. Отчет для внешних органов**

Стандартизированный отчет для предоставления в контролирующие органы.

**Параметры:**
- Дата отчета
- Форма отчета (выбор из предустановленных шаблонов)

**Особенности:**
- Строго определенная форма
- Обязательные подписи и печати (места для них)
- Соответствие требованиям законодательства

### 6.3 Процесс генерации отчета

**Синхронная генерация (простые отчеты):**
1. Пользователь выбирает тип отчета
2. Заполняет параметры
3. Выбирает формат (DOCX/XLSX/PDF)
4. Нажимает "Сформировать"
5. Система генерирует отчет (< 5 секунд)
6. Отчет сразу доступен для скачивания

**Асинхронная генерация (сложные отчеты):**
1. Пользователь настраивает параметры отчета
2. Выбирает формат
3. Нажимает "Сформировать"
4. Система создает задачу на генерацию
5. Пользователь получает уведомление "Отчет формируется..."
6. Может продолжать работу с системой
7. По завершении (1-5 минут):
   - Push-уведомление в браузере
   - Email-уведомление (опционально)
   - Отчет появляется в разделе "Мои отчеты"
8. Отчет доступен для скачивания в течение 30 дней

**Критерии выбора типа генерации:**
- Синхронная: < 1000 строк данных, простые вычисления
- Асинхронная: > 1000 строк, сложные вычисления, графики

### 6.4 Шаблоны отчетов

**Системные шаблоны:**
- Предустановленные шаблоны для стандартных отчетов
- Нельзя изменить или удалить
- Всегда доступны всем пользователям

**Пользовательские шаблоны:**
- Создаются администратором
- Настраиваемые поля и фильтры
- Сохраняемые параметры
- Доступны выбранным ролям

**Создание шаблона:**
1. Выбор базового типа отчета
2. Настройка столбцов (какие показывать)
3. Настройка фильтров по умолчанию
4. Настройка форматирования
5. Сохранение под именем
6. Назначение прав доступа (какие роли видят)

**Использование шаблона:**
- Выбор из списка "Мои шаблоны"
- Параметры предзаполнены
- Возможность изменить перед генерацией
- Быстрая генерация отчета по сохраненным настройкам

### 6.5 Хранение и управление отчетами

**Раздел "Мои отчеты":**
- Список всех сгенерированных отчетов пользователя
- Информация:
  - Название отчета
  - Дата и время генерации
  - Параметры
  - Формат
  - Размер файла
  - Статус (генерируется/готов/ошибка)
- Действия:
  - Скачать
  - Удалить
  - Повторить с теми же параметрами
  - Отправить по email

**Автоматическое удаление:**
- Отчеты старше 30 дней удаляются автоматически
- За 3 дня до удаления отправляется уведомление
- Возможность продлить хранение (еще на 30 дней)

**Общие отчеты:**
- Администратор может создать общий отчет
- Доступен всем пользователям с определенными ролями
- Не удаляется автоматически
- Обновляется по расписанию (ежедневно/еженедельно/ежемесячно)

### 6.6 Экспорт данных

**Экспорт списков:**
- Любой список в системе можно экспортировать в Excel
- Экспортируются только видимые столбцы
- Применяются текущие фильтры и сортировка
- Кнопка "Экспорт" доступна на всех страницах со списками

**Массовый экспорт:**
- Экспорт нескольких отчетов одновременно
- Создание ZIP-архива
- Отправка архива по email

### 6.7 Бизнес-правила

1. Пользователь видит отчеты только по своей зоне ответственности
2. Наблюдатель организации видит отчеты по всей организации
3. Отчет нельзя изменить после генерации
4. Отчет можно сгенерировать повторно с теми же параметрами
5. Максимальный размер отчета - 50 МБ
6. Отчеты с ошибкой сохраняются для анализа
7. История генерации отчетов хранится в журнале аудита
8. Шаблоны отчетов могут создавать только администраторы

---

## 7. Система прав доступа (RBAC)

### 7.1 Назначение модуля

Модуль реализует ролевую модель управления доступом (Role-Based Access Control) с поддержкой зон ответственности.

### 7.2 Роли в системе

Система поддерживает 6 основных ролей:

**Роль-1: Наблюдатель организации**
- Зона ответственности: вся организация
- Доступ: только просмотр
- Типичный пользователь: руководство организации, аналитики

**Роль-2: Наблюдатель департамента**
- Зона ответственности: один департамент
- Доступ: только просмотр своего департамента
- Типичный пользователь: руководитель департамента (без прав редактирования)

**Роль-3: Начальник управления**
- Зона ответственности: одно управление
- Доступ: 
  - Просмотр всего департамента
  - Редактирование своего управления
- Типичный пользователь: руководитель управления

**Роль-4: Системный администратор**
- Зона ответственности: вся организация
- Доступ: полный доступ ко всем функциям
- Типичный пользователь: IT-администратор, главный кадровик

**Роль-5: Кадровый администратор**
- Зона ответственности: настраиваемая (департамент/управление/отдел)
- Доступ: управление персоналом в зоне ответственности
- Типичный пользователь: специалист отдела кадров

**Роль-6: Начальник отдела**
- Зона ответственности: один отдел
- Доступ:
  - Просмотр всего департамента
  - Редактирование своего отдела
- Типичный пользователь: руководитель отдела

### 7.3 Матрица прав доступа

| Функция | Роль-1 | Роль-2 | Роль-3 | Роль-4 | Роль-5 | Роль-6 |
|---------|--------|--------|--------|--------|--------|--------|
| **Просмотр структуры** | Вся орг. | Свой деп. | Свой деп. | Вся орг. | Зона отв. | Свой деп. |
| **Создание подразделений** | ✗ | ✗ | ✗ | ✓ | ✗ | ✗ |
| **Редактирование подразделений** | ✗ | ✗ | Свое упр. | ✓ | ✗ | Свой отдел |
| **Удаление подразделений** | ✗ | ✗ | ✗ | ✓ | ✗ | ✗ |
| **Просмотр сотрудников** | Вся орг. | Свой деп. | Свой деп. | Вся орг. | Зона отв. | Свой деп. |
| **Создание сотрудников (прием)** | ✗ | ✗ | ✗ | ✓ | Зона отв. | ✗ |
| **Редактирование данных сотрудника** | ✗ | ✗ | Свое упр. | ✓ | Зона отв. | Свой отдел |
| **Увольнение сотрудников** | ✗ | ✗ | ✗ | ✓ | Зона отв. | ✗ |
| **Перевод сотрудников** | ✗ | ✗ | Внутри упр. | ✓ | Зона отв. | Внутри отд. |
| **Просмотр статусов** | Вся орг. | Свой деп. | Свой деп. | Вся орг. | Зона отв. | Свой деп. |
| **Изменение текущего статуса** | ✗ | ✗ | Свое упр. | ✓ | Зона отв. | Свой отдел |
| **Планирование статусов** | ✗ | ✗ | Свое упр. | ✓ | Зона отв. | Свой отдел |
| **Инициация откомандирования** | ✗ | ✗ | Свое упр. | ✓ | ✗ | ✗ |
| **Одобрение прикомандирования** | ✗ | ✗ | В свое упр. | ✓ | ✗ | ✗ |
| **Просмотр штатного расписания** | Вся орг. | Свой деп. | Свой деп. | Вся орг. | Зона отв. | Свой деп. |
| **Редактирование штатного расписания** | ✗ | ✗ | ✗ | ✓ | Зона отв. | ✗ |
| **Создание вакансий** | ✗ | ✗ | ✗ | ✓ | Зона отв. | ✗ |
| **Закрытие вакансий** | ✗ | ✗ | ✗ | ✓ | Зона отв. | ✗ |
| **Назначение "за счёт"** | ✗ | ✗ | ✗ | ✓ | Зона отв. | ✗ |
| **Генерация отчетов** | Вся орг. | Свой деп. | Свой деп. | Вся орг. | Зона отв. | Свой деп. |
| **Создание шаблонов отчетов** | ✗ | ✗ | ✗ | ✓ | ✗ | ✗ |
| **Просмотр журнала аудита** | Вся орг. | Свой деп. | Свой деп. | Вся орг. | Зона отв. | Свой деп. |
| **Управление пользователями** | ✗ | ✗ | ✗ | ✓ | ✗ | ✗ |
| **Управление ролями** | ✗ | ✗ | ✗ | ✓ | ✗ | ✗ |
| **Управление справочниками** | ✗ | ✗ | ✗ | ✓ | ✗ | ✗ |
| **Просмотр портала сотрудников** | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |

### 7.4 Зоны ответственности

**Определение зоны ответственности:**
При назначении роли пользователю указывается его зона ответственности:
- Для Роли-1: вся организация (не настраивается)
- Для Роли-2: департамент (выбирается из списка)
- Для Роли-3: управление (выбирается из списка)
- Для Роли-4: вся организация (не настраивается)
- Для Роли-5: департамент, управление или отдел (выбирается из списка)
- Для Роли-6: отдел (выбирается из списка)

**Наследование прав:**
- Если зона ответственности - департамент, пользователь имеет доступ ко всем управлениям и отделам внутри
- Если зона ответственности - управление, пользователь имеет доступ ко всем отделам внутри
- Если зона ответственности - отдел, пользователь имеет доступ только к этому отделу

**Множественные зоны ответственности:**
- Один пользователь может иметь несколько ролей
- Например: Роль-3 для Управления А и Роль-3 для Управления Б
- Права объединяются (ИЛИ)
- При конфликте прав приоритет у более широкой зоны

### 7.5 Управление пользователями

**Создание пользователя:**
1. Системный администратор (Роль-4) создает учетную запись
2. Указывает базовые данные:
   - Email (используется для входа)
   - Фамилия, Имя, Отчество
   - Телефон
3. Назначает роль(и)
4. Указывает зону ответственности для каждой роли
5. Устанавливает статус:
   - Активен (может входить в систему)
   - Заблокирован (вход запрещен)
6. Отправка уведомления пользователю с инструкциями

**Редактирование пользователя:**
- Изменение личных данных
- Изменение ролей
- Изменение зон ответственности
- Блокировка/разблокировка доступа

**Удаление пользователя:**
- Мягкое удаление (архивация)
- Блокировка доступа к системе
- Сохранение истории действий в журнале аудита

**Связь пользователя с сотрудником:**
- Пользователь может быть связан с сотрудником в системе
- Связь устанавливается вручную
- Один сотрудник может иметь только одну учетную запись
- Одна учетная запись может быть связана только с одним сотрудником
- Связь опциональна (пользователь может не быть сотрудником, например, внешний аудитор)

### 7.6 Аутентификация и авторизация

**Процесс входа:**
1. Пользователь вводит email и пароль во внешней системе авторизации
2. Внешняя система проверяет учетные данные
3. При успешной аутентификации выдает JWT-токен
4. Токен содержит:
   - User ID
   - Email
   - Время выдачи
   - Время истечения
5. Пользователь передает токен в систему "Расход Организации"
6. Система валидирует токен
7. Система запрашивает роли пользователя из своей БД
8. Создает сессию с правами доступа

**Проверка прав доступа:**
На каждом запросе система проверяет:
1. Валидность JWT-токена
2. Наличие активной сессии
3. Соответствие запрашиваемого действия правам роли
4. Принадлежность объекта зоне ответственности

**Истечение сессии:**
- JWT-токен действителен 24 часа
- Система автоматически обновляет токен при активности
- При истечении токена пользователь перенаправляется на повторный вход

### 7.7 Журнал безопасности

**Логирование событий безопасности:**
- Успешный вход в систему
- Неудачная попытка входа
- Выход из системы
- Изменение прав доступа
- Попытка доступа к запрещенному ресурсу
- Блокировка/разблокировка пользователя

**Содержание записи:**
- Дата и время
- User ID
- IP-адрес
- Тип события
- Результат (успех/ошибка)
- Дополнительная информация

**Хранение:**
- Записи хранятся 1 год
- Доступ только для Роли-4
- Невозможность изменения или удаления

### 7.8 Бизнес-правила

1. Один пользователь может иметь несколько ролей
2. Нельзя удалить последнего пользователя с Ролью-4
3. Нельзя изменить свою роль самому себе
4. Зона ответственности обязательна для всех ролей кроме Роли-1 и Роли-4
5. При блокировке пользователя все его активные сессии завершаются
6. Роли-3 и Роли-6 не могут редактировать сотрудников выше своего уровня в иерархии
7. Кадровый администратор (Роль-5) может работать только с неруководящими должностями

---

## 8. Журнал аудита и история изменений

### 8.1 Назначение модуля

Модуль обеспечивает полное логирование всех операций в системе для обеспечения прозрачности, соответствия требованиям и возможности восстановления данных.

### 8.2 Что логируется

**Операции с сотрудниками:**
- Прием на работу (создание карточки)
- Изменение личных данных
- Изменение контактной информации
- Перевод в другое подразделение
- Изменение должности
- Увольнение
- Восстановление из архива

**Операции со статусами:**
- Установка нового статуса
- Изменение текущего статуса
- Планирование будущего статуса
- Отмена запланированного статуса
- Продление статуса
- Досрочное завершение статуса

**Операции с организационной структурой:**
- Создание подразделения
- Изменение наименования/кода подразделения
- Перемещение подразделения
- Архивация подразделения
- Восстановление подразделения

**Операции с прикомандированием/откомандированием:**
- Создание запроса на откомандирование
- Создание запроса на прикомандирование
- Одобрение запроса
- Отклонение запроса
- Досрочное завершение
- Продление срока

**Операции со штатным расписанием:**
- Создание штатной единицы
- Изменение количества штатных единиц
- Удаление штатной единицы
- Создание вакансии
- Изменение вакансии
- Закрытие вакансии
- Создание назначения "за счёт"
- Завершение назначения "за счёт"

**Операции с пользователями:**
- Создание пользователя
- Изменение ролей
- Изменение зон ответственности
- Блокировка пользователя
- Разблокировка пользователя
- Удаление пользователя

**Операции со справочниками:**
- Добавление элемента справочника
- Изменение элемента справочника
- Удаление элемента справочника

**Операции с отчетами:**
- Генерация отчета
- Скачивание отчета
- Удаление отчета

### 8.3 Структура записи журнала

Каждая запись в журнале содержит:

**Обязательные поля:**
- ID записи (уникальный)
- Дата и время операции (с точностью до миллисекунды)
- Пользователь (кто выполнил операцию)
- Тип сущности (сотрудник/статус/подразделение/и т.д.)
- ID сущности
- Тип операции (создание/изменение/удаление/просмотр)
- Результат (успех/ошибка)

**Дополнительные поля:**
- Старое значение (до изменения) - JSON
- Новое значение (после изменения) - JSON
- Измененные поля (список)
- IP-адрес пользователя
- User Agent (браузер)
- Комментарий пользователя (если указан)
- Код ошибки (если операция неуспешна)
- Сообщение об ошибке

### 8.4 Просмотр журнала аудита

**Основной список:**
- Таблица со всеми записями
- Столбцы:
  - Дата/время
  - Пользователь
  - Операция
  - Сущность
  - Результат
- Пагинация (50 записей на страницу)

**Фильтрация:**
- По пользователю
- По типу операции
- По типу сущности
- По результату (успех/ошибка)
- По периоду (дата от/до)
- По IP-адресу
- По изменяемой сущности (ID)

**Поиск:**
- Полнотекстовый поиск по комментариям
- Поиск по ID сущности
- Поиск по имени пользователя

**Сортировка:**
- По дате (по умолчанию: новые сверху)
- По пользователю
- По типу операции

**Детальный просмотр записи:**
При клике на запись открывается модальное окно с полной информацией:
- Все поля записи
- Сравнение "до" и "после" (side-by-side)
- Визуальное выделение измененных полей
- Информация о пользователе:
  - ФИО
  - Роль на момент операции
  - Email
- Ссылка на объект (если он существует)
- Возможность добавить комментарий к записи (для Роли-4)

### 8.5 История изменений объекта

Для каждого объекта (сотрудник, подразделение и т.д.) доступна его полная история:

**Вкладка "История" в карточке объекта:**
- Хронологический список всех изменений
- Группировка по датам
- Визуальное отображение изменений

**Timeline (временная шкала):**
- Графическое представление событий
- Иконки для разных типов операций:
  - 👤 Изменение личных данных
  - 📍 Перевод
  - 📊 Изменение статуса
  - 🔄 Прикомандирование/откомандирование
- Клик по событию - детальная информация

**Сравнение версий:**
- Выбор двух моментов времени
- Side-by-side сравнение состояния объекта
- Подсветка изменений

### 8.6 Экспорт журнала аудита

**Экспорт в Excel:**
- Экспорт текущего фильтра/поиска
- Все поля записей
- Настраиваемый список столбцов
- Максимум 10 000 записей за раз

**Экспорт в PDF:**
- Форматированный отчет
- Возможность добавить комментарии
- Подходит для предоставления аудиторам

**Экспорт в JSON:**
- Полные данные включая старые и новые значения
- Для программного анализа
- Используется для backup

### 8.7 Восстановление данных

**Rollback операции:**
Только для Роли-4 (Системный администратор):
1. Выбор записи в журнале
2. Кнопка "Откатить изменение"
3. Подтверждение действия
4. Система:
   - Восстанавливает старые значения
   - Создает новую запись в журнале (тип: rollback)
   - Уведомляет затронутых пользователей

**Ограничения rollback:**
- Нельзя откатить операцию старше 30 дней
- Нельзя откатить создание объекта (но можно удалить)
- Нельзя откатить удаление объекта (но можно восстановить из архива)
- Нельзя откатить, если связанные объекты изменились
- Для некоторых операций требуется ручное восстановление

**Массовое восстановление:**
- Восстановление группы связанных операций
- Например: откат массового перевода сотрудников
- Выбор группы записей
- Подтверждение с проверкой последствий

### 8.8 Аналитика по журналу

**Отчет по активности пользователей:**
- Количество операций по пользователям
- Типы операций
- Период активности
- Топ активных пользователей

**Отчет по ошибкам:**
- Список всех неуспешных операций
- Группировка по типу ошибки
- Частота возникновения
- Пользователи, столкнувшиеся с ошибкой

**Отчет по изменениям:**
- Статистика изменений по типам сущностей
- Самые частые изменения
- Подразделения с наибольшим количеством изменений
- Динамика изменений по времени

### 8.9 Хранение и архивация

**Политика хранения:**
- Записи хранятся минимум 3 года
- После 3 лет можно архивировать (перенос в отдельное хранилище)
- Архивные записи доступны только для чтения
- Полное удаление записей запрещено

**Партиционирование:**
- Данные разбиты по месяцам
- Оптимизация запросов по дате
- Быстрая архивация старых партиций

**Backup журнала:**
- Ежедневный backup всех записей
- Хранение backup 7 лет
- Возможность восстановления из backup

### 8.10 Бизнес-правила

1. Каждая операция записывается в журнал атомарно (вместе с основной операцией)
2. Записи журнала не могут быть изменены или удалены пользователями
3. Только Роль-4 имеет доступ ко всему журналу
4. Другие роли видят записи только в своей зоне ответственности
5. При ошибке операции также создается запись в журнале
6. Запись содержит полные данные для возможного восстановления
7. Операции просмотра не логируются (только изменения)
8. Системные операции (автоматические) помечаются как system user

---

## 9. Система уведомлений

### 9.1 Назначение модуля

Модуль обеспечивает информирование пользователей о важных событиях в системе через различные каналы.

### 9.2 Типы уведомлений

**1. Push-уведомления (в браузере)**
- Появляются в правом верхнем углу
- Отображаются в реальном времени (через WebSocket)
- Автоматически исчезают через 5 секунд
- Можно закрыть вручную
- Не требуют обновления страницы

**2. Внутренние уведомления (в системе)**
- Отображаются в меню уведомлений (иконка колокольчика)
- Сохраняются в БД
- Можно пометить как прочитанное/непрочитанное
- Можно удалить
- Группируются по типам

**3. Email-уведомления**
- Отправляются на email пользователя
- Опциональны (настраиваются в профиле)
- Содержат ссылку на объект в системе
- Форматированные HTML-письма

### 9.3 События, генерирующие уведомления

**Связанные с сотрудниками:**
- Прием нового сотрудника в подразделение
- Увольнение сотрудника из подразделения
- Перевод сотрудника в подразделение
- Перевод сотрудника из подразделения
- Изменение статуса сотрудника (для руководителя)
- Приближение окончания длительного статуса (за 3 дня)
  - Конец отпуска
  - Конец командировки
  - Конец учебы

**Связанные с прикомандированием:**
- Получен запрос на прикомандирование (руководителю-источнику)
- Получен запрос на откомандирование (руководителю-приемнику)
- Запрос одобрен (инициатору)
- Запрос отклонен (инициатору)
- Приближение окончания срока откомандирования (за 7 дней):
  - Уведомление обеим сторонам
- Истечение срока откомандирования
- Досрочное завершение откомандирования

**Связанные со штатным расписанием:**
- Создана новая вакансия в подразделении
- Вакансия закрыта (принят сотрудник)
- Вакансия долго не закрывается (>90 дней)
- Изменено штатное расписание подразделения

**Связанные с отчетами:**
- Отчет сформирован (асинхронная генерация)
- Ошибка при формировании отчета
- Скоро удаление отчета (за 3 дня)

**Системные:**
- Изменение прав доступа пользователя
- Назначена новая роль
- Изменена зона ответственности
- Блокировка учетной записи
- Обновление системы (плановое техническое обслуживание)

### 9.4 Получатели уведомлений

**Автоматическое определение получателей:**

1. **Руководители подразделений:**
   - При изменениях в их подразделении
   - При запросах на прикомандирование/откомандирование
   - При приеме/увольнении сотрудников

2. **Инициаторы операций:**
   - Результат их запросов
   - Завершение асинхронных операций

3. **Кадровые администраторы:**
   - Изменения в зоне ответственности
   - Критические события (долго открытые вакансии)

4. **Системные администраторы:**
   - Все ошибки в системе
   - Критические события
   - Системные уведомления

5. **Конкретные пользователи:**
   - Упомянутые в комментариях (@username)
   - Назначенные ответственными

### 9.5 Центр уведомлений

**Интерфейс:**
- Иконка колокольчика в шапке сайта
- Счетчик непрочитанных уведомлений
- При клике - выпадающее меню с последними 10 уведомлениями
- Кнопка "Показать все" - переход к полному списку

**Список уведомлений:**
- Все уведомления пользователя
- Сортировка по дате (новые сверху)
- Фильтрация:
  - Все / Непрочитанные / Прочитанные
  - По типу события
  - По дате
- Действия:
  - Пометить как прочитанное/непрочитанное
  - Удалить
  - Перейти к объекту уведомления

**Внешний вид уведомления:**
- Иконка типа события
- Заголовок
- Краткое описание
- Дата и время
- Индикатор прочитано/непрочитано
- Кнопка "Перейти"

### 9.6 Настройки уведомлений

**В профиле пользователя:**

Каждый пользователь может настроить:

1. **Каналы доставки:**
   - Push-уведомления (в браузере): ВКЛ/ВЫКЛ
   - Внутренние уведомления: ВКЛ/ВЫКЛ (нельзя отключить обязательные)
   - Email-уведомления: ВКЛ/ВЫКЛ

2. **Типы уведомлений:**
   Для каждого типа события отдельная настройка:
   - Не уведомлять
   - Только внутренние уведомления
   - Внутренние + Push
   - Внутренние + Push + Email
   - Только Email

3. **Время отправки Email:**
   - Немедленно
   - Дайджест раз в час
   - Дайджест раз в день (время выбирается)

4. **Не беспокоить:**
   - Временное отключение всех уведомлений
   - Установка периода "не беспокоить"
   - Исключения для критических уведомлений

### 9.7 Шаблоны уведомлений

**Структура шаблона:**
- Заголовок (короткий, для Push и внутренних)
- Тело сообщения (для Email)
- Переменные (подставляются из контекста)
- Ссылка на объект

**Примеры шаблонов:**

**Прием сотрудника:**
```
Заголовок: Новый сотрудник в подразделении
Текст: В подразделение {division_name} принят сотрудник {employee_fio} на должность {position_name}. Дата приема: {hire_date}.
Ссылка: /employees/{employee_id}
```

**Запрос на откомандирование:**
```
Заголовок: Запрос на откомандирование сотрудника
Текст: Поступил запрос на откомандирование сотрудника {employee_fio} из {from_division} в {to_division} на период с {start_date} по {end_date}. Причина: {reason}. Требуется ваше согласование.
Ссылка: /secondments/{secondment_id}
Действие: [Одобрить] [Отклонить]
```

**Окончание отпуска:**
```
Заголовок: Скоро окончание отпуска
Текст: Через 3 дня ({date}) заканчивается отпуск сотрудника {employee_fio}. Не забудьте обновить статус.
Ссылка: /employees/{employee_id}/status
```

### 9.8 Интеграция с другими модулями

**WebSocket соединение:**
- Устанавливается при входе пользователя
- Поддерживается на протяжении сессии
- Автоматическое переподключение при обрыве
- Передача уведомлений в реальном времени

**Очередь уведомлений:**
- Все уведомления попадают в очередь (RabbitMQ / Redis)
- Асинхронная обработка
- Гарантия доставки
- Повторная отправка при ошибке (до 3 раз)

**Email-сервис:**
- Использует SMTP для отправки
- Шаблонизатор для HTML-писем
- Прикрепление логотипа организации
- Трекинг доставки и открытия

### 9.9 Административные функции

**Массовая рассылка (только Роль-4):**
- Создание объявления для всех или выбранных пользователей
- Выбор ролей-получателей
- Выбор подразделений-получателей
- Опциональное требование подтверждения прочтения
- Отслеживание статуса прочтения

**Статистика уведомлений:**
- Количество отправленных уведомлений по типам
- Процент прочитанных
- Время между отправкой и прочтением
- Количество переходов по ссылкам
- Ошибки доставки Email

**Логирование:**
- Все отправленные уведомления логируются
- Хранение 90 дней
- Возможность повторной отправки

### 9.10 Бизнес-правила

1. Критические уведомления нельзя отключить
2. Каждое уведомление имеет приоритет (высокий/средний/низкий)
3. Push-уведомления с высоким приоритетом требуют подтверждения прочтения
4. Email не отправляется, если в настройках выключены Email-уведомления
5. При отсутствии WebSocket соединения Push-уведомления не отправляются
6. Дайджесты Email объединяют несколько уведомлений в одно письмо
7. Уведомления старше 90 дней автоматически удаляются
8. Максимум 50 непрочитанных уведомлений в центре уведомлений (старые автоматически помечаются прочитанными)

---

## 10. Справочники

### 10.1 Назначение модуля

Модуль управления справочными данными, используемыми в системе для стандартизации информации и обеспечения целостности данных.

### 10.2 Список справочников

**1. Справочник должностей**

**Назначение:** Перечень всех должностей, которые могут занимать сотрудники.

**Поля:**
- Наименование должности
- Код должности (уникальный)
- Ранг (приоритет для сортировки)
- Категория (руководитель/специалист/обслуживающий персонал)
- Требуемое образование
- Минимальный стаж
- Описание обязанностей
- Признак "Активна"

**Особенности:**
- Иерархическая структура по рангам
- Используется в штатном расписании
- Используется при приеме и переводе сотрудников
- Неактивные должности скрыты, но остаются в истории

**Пример:**
```
Наименование: Начальник управления
Код: MGR_DEPT_001
Ранг: 100 (высший)
Категория: Руководитель
Образование: Высшее
Стаж: 5 лет
```

---

**2. Справочник воинских званий**

**Назначение:** Перечень воинских званий для военизированных организаций.

**Поля:**
- Наименование звания
- Код звания
- Ранг (для сортировки)
- Тип (офицерский состав/рядовой состав)
- Признак "Активно"

**Иерархия:**
- Рядовой состав (1-30)
- Младший офицерский состав (31-60)
- Старший офицерский состав (61-90)
- Высший офицерский состав (91-100)

**Использование:**
- В карточке сотрудника
- В отчетах (группировка по званиям)
- В портале сотрудников

---

**3. Справочник причин отсутствия**

**Назначение:** Стандартизация причин установки статусов отсутствия.

**Поля:**
- Наименование причины
- Код причины
- Тип статуса (связь со статусами)
- Требуется документ (да/нет)
- Максимальная длительность (дней)
- Признак "Активна"

**Примеры:**
```
Отпуск:
  - Ежегодный оплачиваемый отпуск (до 45 дней)
  - Дополнительный отпуск (до 14 дней)
  - Учебный отпуск (до 30 дней)

Больничный:
  - Временная нетрудоспособность
  - Уход за больным родственником

Командировка:
  - Служебная командировка по РФ
  - Служебная командировка за рубеж
```

---

**4. Справочник причин увольнения**

**Назначение:** Классификация причин увольнения сотрудников.

**Поля:**
- Наименование причины
- Код причины
- Статья ТК РФ (если применимо)
- Тип (по собственному желанию/по инициативе работодателя/по соглашению сторон)
- Влияет на статистику текучести (да/нет)
- Признак "Активна"

**Примеры:**
```
- По собственному желанию (ст. 80 ТК РФ)
- По соглашению сторон (ст. 78 ТК РФ)
- За прогул (ст. 81 п.6а ТК РФ)
- Истечение срока трудового договора (ст. 79 ТК РФ)
- Выход на пенсию
```

---

**5. Справочник причин перевода**

**Назначение:** Стандартизация причин перевода сотрудников.

**Поля:**
- Наименование причины
- Код причины
- Тип перевода (постоянный/временный)
- Требуется согласие сотрудника (да/нет)
- Признак "Активна"

**Примеры:**
```
- Повышение в должности
- Производственная необходимость
- По инициативе сотрудника
- Реорганизация структуры
- Сокращение штата
- Понижение в должности
```

---

**6. Справочник причин откомандирования**

**Назначение:** Классификация причин временного перемещения сотрудников.

**Поля:**
- Наименование причины
- Код причины
- Максимальная длительность (дней)
- Требуется приказ (да/нет)
- Признак "Активна"

**Примеры:**
```
- Временное усиление подразделения
- Замещение отсутствующего сотрудника
- Выполнение специального проекта
- Стажировка
- Обмен опытом
```

---

**7. Справочник типов документов**

**Назначение:** Классификация документов, которые можно прикреплять к объектам.

**Поля:**
- Наименование типа
- Код типа
- Применяется к (сотрудник/статус/прикомандирование/другое)
- Обязательность (обязательный/опциональный)
- Допустимые форматы файлов
- Максимальный размер файла (МБ)
- Признак "Активен"

**Примеры:**
```
Для сотрудников:
  - Копия паспорта (PDF, JPG, до 5 МБ)
  - Трудовой договор (PDF, DOCX, до 10 МБ)
  - Диплом об образовании (PDF, JPG, до 5 МБ)

Для статусов:
  - Приказ об отпуске (PDF, до 5 МБ)
  - Листок нетрудоспособности (PDF, JPG, до 5 МБ)
  - Командировочное удостоверение (PDF, до 5 МБ)
```

---

**8. Справочник настроек системы**

**Назначение:** Хранение системных параметров и настроек.

**Поля:**
- Ключ настройки (уникальный)
- Значение
- Тип данных (строка/число/булево/дата)
- Описание
- Категория (общие/уведомления/отчеты/безопасность)
- Можно ли изменять (да/нет)

**Примеры настроек:**
```
Общие:
  - organization_name = "Название организации"
  - max_vacation_days = 45
  - min_secondment_days = 1
  - max_secondment_days = 180

Уведомления:
  - notification_before_status_end_days = 3
  - notification_before_secondment_end_days = 7
  - email_from_address = "noreply@organization.ru"

Отчеты:
  - report_retention_days = 30
  - max_report_size_mb = 50

Безопасность:
  - session_timeout_hours = 24
  - password_expiration_days = 90
  - max_login_attempts = 5
```

### 10.3 Управление справочниками

**Доступ:**
Только пользователи с Ролью-4 (Системный администратор) могут управлять справочниками.

**Общие операции для всех справочников:**

**1. Просмотр:**
- Список всех элементов справочника
- Отображение активных и неактивных элементов (с фильтром)
- Поиск по наименованию или коду
- Сортировка по наименованию или рангу

**2. Добавление элемента:**
- Заполнение всех обязательных полей
- Автоматическая валидация:
  - Уникальность кода
  - Корректность типа данных
  - Соответствие ограничениям
- Сохранение
- Запись в журнал аудита

**3. Редактирование элемента:**
- Изменение любых полей кроме кода
- Валидация изменений
- Сохранение истории изменений
- Запись в журнал аудита

**4. Деактивация элемента:**
- Установка признака "Неактивен"
- Элемент скрывается из списков выбора
- Остается в истории и связанных объектах
- Можно активировать обратно

**5. Удаление элемента:**
- Разрешено только если элемент не используется
- Проверка использования:
  - Нет сотрудников с этой должностью
  - Нет активных статусов с этой причиной
  - И т.д.
- Мягкое удаление (архивация)
- Запись в журнал аудита

**6. Импорт/экспорт:**
- Экспорт справочника в Excel
- Импорт из Excel (для массового добавления)
- Валидация всех записей при импорте
- Отчет об ошибках импорта

### 10.4 Использование справочников

**В формах:**
- Выпадающие списки (select)
- Автодополнение (autocomplete) для больших справочников
- Отображаются только активные элементы
- Возможность быстрого добавления (если есть права)

**В отчетах:**
- Фильтрация по элементам справочников
- Группировка по справочникам
- Отображение наименований вместо кодов

**В API:**
- Отдельный эндпоинт для каждого справочника
- Кеширование на стороне клиента
- Версионирование справочников

### 10.5 Справочник настроек (детально)

**Категории настроек:**

**Общие настройки организации:**
```
organization_name: Название организации
organization_logo: URL логотипа
organization_address: Адрес
organization_phone: Телефон
organization_email: Email
max_vacation_days: Максимальная длительность отпуска (дней)
min_secondment_days: Минимальная длительность откомандирования (дней)
max_secondment_days: Максимальная длительность откомандирования (дней)
max_secondment_extensions: Максимальное количество продлений откомандирования
```

**Настройки уведомлений:**
```
notifications_enabled: Включить уведомления (да/нет)
notification_before_status_end_days: За сколько дней уведомлять об окончании статуса
notification_before_secondment_end_days: За сколько дней уведомлять об окончании откомандирования
vacation_notification_days: За сколько дней уведомлять о запланированном отпуске
email_from_address: Email отправителя
email_from_name: Имя отправителя
smtp_host: SMTP сервер
smtp_port: SMTP порт
smtp_use_tls: Использовать TLS (да/нет)
```

**Настройки отчетов:**
```
report_retention_days: Срок хранения отчетов (дней)
max_report_size_mb: Максимальный размер отчета (МБ)
async_report_threshold: Порог для асинхронной генерации (строк)
report_logo_url: URL логотипа для отчетов
report_footer_text: Текст футера отчетов
```

**Настройки безопасности:**
```
session_timeout_hours: Таймаут сессии (часов)
jwt_secret_key: Секретный ключ JWT
jwt_expiration_hours: Срок действия JWT (часов)
password_min_length: Минимальная длина пароля
password_require_uppercase: Требовать заглавные буквы (да/нет)
password_require_numbers: Требовать цифры (да/нет)
password_require_special: Требовать спецсимволы (да/нет)
password_expiration_days: Срок действия пароля (дней)
max_login_attempts: Максимум попыток входа
account_lockout_minutes: Блокировка аккаунта на (минут)
```

**Настройки аудита:**
```
audit_log_retention_days: Срок хранения журнала аудита (дней)
audit_detailed_logging: Детальное логирование (да/нет)
audit_log_api_calls: Логировать API вызовы (да/нет)
```

### 10.6 Версионирование справочников

**Необходимость:**
При изменении справочников старые данные должны отображаться корректно.

**Реализация:**
- Каждое изменение элемента справочника создает новую версию
- Старые версии хранятся в истории
- При отображении исторических данных используется версия на момент создания

**Пример:**
```
Должность "Инженер" была переименована в "Ведущий инженер"
При просмотре старого перевода (2023 год) отображается "Инженер"
При просмотре нового перевода (2024 год) отображается "Ведущий инженер"
```

### 10.7 Локализация справочников

**Мультиязычность:**
Возможность добавления переводов наименований справочников:
- Русский (по умолчанию)
- Английский (опционально)
- Другие языки (опционально)

**Применение:**
- Выбор языка в профиле пользователя
- Отображение справочников на выбранном языке
- Экспорт отчетов на выбранном языке

### 10.8 Бизнес-правила

1. Код элемента справочника не может быть изменен после создания
2. Нельзя удалить элемент справочника, если он используется
3. Деактивация элемента не влияет на существующие объекты
4. Все изменения справочников логируются в журнале аудита
5. Импорт справочника не удаляет существующие элементы
6. При импорте существующие элементы обновляются, новые добавляются
7. Системные настройки имеют валидацию допустимых значений
8. Изменение критических настроек требует подтверждения

---

## 11. Портал сотрудников

### 11.1 Назначение

Публичный портал для отображения организационной структуры и сотрудников с фотографиями.

### 11.2 Функции

**Отображение структуры:**
- Иерархические сетки подразделений
- Для каждого подразделения: список сотрудников

**Отображение сотрудников:**
- Фотография 3×4
- ФИО
- Должность
- Контакты (опционально)

**Сортировка:**
- По должностям (согласно иерархии из справочника)
- По ФИО (алфавит)

**Фильтрация:**
- По подразделению
- По должности
- Поиск по ФИО

**Доступ:**
- Доступен всем пользователям системы
- Публичный доступ (если настроено)

---

## Заключение

Данный документ описывает полный функционал системы "Расход Организации", включающий:
- 11 основных модулей
- 6 ролей с детальной матрицей прав
- Полный жизненный цикл сотрудников
- Гибкую организационную структуру
- Систему прикомандирования/откомандирования
- Штатное расписание и вакансии
- Генерацию отчетов в 3 форматах
- Детальный аудит всех операций
- Систему уведомлений

Система разработана для обеспечения эффективного управления человеческими ресурсами в организациях с иерархической структурой.
